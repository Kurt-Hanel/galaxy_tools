<tool id="staramr" name="staramr" version="0.2.0">
    <requirements>
        <requirement type="package" version="0.2.0">staramr</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        staramr search

        --nprocs "\${GALAXY_SLOTS:-1}"

        --pid-threshold $pid_threshold
        --percent-length-overlap-resfinder $plength_resfinder
        --percent-length-overlap-pointfinder $plength_pointfinder

        ${report_all_blast}
        ${exclude_negatives}
        ${exclude_resistance_phenotypes}

        --output-summary $summary
        --output-resfinder $resfinder
        --output-pointfinder $pointfinder
        --output-settings $settings
        --output-excel $excel

        --pointfinder-organism salmonella

        $genomes
    ]]></command>
    <inputs>
        <param type="data" name="genomes" format="fasta"/>
        <param name="pid_threshold" type="float" label="Percent identity threshold for BLAST" value="98.0"
               min="0" max="100" help="(--pid-threshold)" />
        <param name="plength_resfinder" type="float" label="Percent length overlap of BLAST hit for ResFinder database" value="60.0"
               min="0" max="100" help="(--percent-length-overlap-resfinder)" />
        <param name="plength_pointfinder" type="float" label="Percent length overlap of BLAST hit for PointFinder database" value="95.0"
               min="0" max="100" help="(--percent-length-overlap-pointfinder)" />
        <param name="report_all_blast" type="boolean" label="Report all BLAST results" truevalue="--report-all-blast" falsevalue=""
               help="Report all BLAST results (includes overlapping hits, mainly for debugging)" />
        <param name="exclude_negatives" type="boolean" label="Exclude negative (non-resistant) results" truevalue="--exclude-negatives" falsevalue="" />
        <param name="exclude_resistance_phenotypes" type="boolean" label="Exclude resistance phenotypes" truevalue="--exclude-resistance-phenotypes" falsevalue="" />
    </inputs>
    <outputs>
        <data format="tabular" name="summary" label="${tool.name} on ${on_string}: summary.tsv" />
        <data format="tabular" name="resfinder" label="${tool.name} on ${on_string}: resfinder.tsv" />
        <data format="tabular" name="pointfinder" label="${tool.name} on ${on_string}: pointfinder.tsv" />
        <data format="txt" name="settings" label="${tool.name} on ${on_string}: settings.txt" />
        <data format="xlsx" name="excel" label="${tool.name} on ${on_string}: results.xlsx" />
    </outputs>
    <help><![CDATA[
        usage: staramr search [-h] [-n NPROCS] [--pid-threshold PID_THRESHOLD]
                      [--percent-length-overlap-resfinder PLENGTH_THRESHOLD_RESFINDER]
                      [--percent-length-overlap-pointfinder PLENGTH_THRESHOLD_POINTFINDER]
                      [--pointfinder-organism POINTFINDER_ORGANISM]
                      [--exclude-negatives] [--report-all-blast]
                      [--exclude-resistance-phenotypes] [-d DATABASE]
                      [-o OUTPUT_DIR]
                      files [files ...]

positional arguments:
  files

optional arguments:
  -h, --help            show this help message and exit
  -n NPROCS, --nprocs NPROCS
                        The number of processing cores to use [16].
  --pid-threshold PID_THRESHOLD
                        The percent identity threshold [98.0].
  --percent-length-overlap-resfinder PLENGTH_THRESHOLD_RESFINDER
                        The percent length overlap for resfinder results [60.0].
  --percent-length-overlap-pointfinder PLENGTH_THRESHOLD_POINTFINDER
                        The percent length overlap for pointfinder results [95.0].
  --pointfinder-organism POINTFINDER_ORGANISM
                        The organism to use for pointfinder {salmonella} [None].
  --exclude-negatives   Exclude negative results (those sensitive to antimicrobials) [False].
  --report-all-blast    Report all blast hits (vs. only top blast hits) [False].
  --exclude-resistance-phenotypes
                        Exclude predicted antimicrobial resistances [False].
  -d DATABASE, --database DATABASE
                        The directory containing the resfinder/pointfinder databases [/home/aaron/workspace/staramr/staramr/databases/data].
  -o OUTPUT_DIR, --output-dir OUTPUT_DIR
                        The output directory for results.  If unset prints all results to stdout.

Example:
	staramr search --output-dir out *.fasta
		Searches the files *.fasta for AMR genes using only the ResFinder database, storing results in the out/ directory.

	staramr search --pointfinder-organism salmonella --output-dir out *.fasta
		Searches *.fasta for AMR genes using ResFinder and PointFinder database with the passed organism, storing results in out/.

    ]]></help>
    <citations>
        <citation type="bibtex">
@misc{githubstaramr,
  author = {Petkau, Aaron},
  year = {2018},
  title = {staramr},
  publisher = {GitHub},
  journal = {GitHub repository},
  url = {https://github.com/phac-nml/staramr},
}</citation>
    </citations>
</tool>
